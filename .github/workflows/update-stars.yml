name: ğŸŒŸ Update GitHub Stars

on:
  push:
    branches:
      - main
      - master
  schedule:
    # Run every 10 minutes
    - cron: '*/10 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  update-stars:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0
      
      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: ğŸ” Update star count in README
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_REPOSITORY_OWNER: ${{ github.repository_owner }}
        run: python scripts/update_stars.py
      
      - name: ğŸ“ Commit and create pull request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "ğŸŒŸ auto: update stars and growth chart"
          branch: auto/update-stars
          delete-branch: true
          title: "ğŸ“Š Automated: Update GitHub stars and growth chart"
          body: |
            This is an automated pull request to update the GitHub star count and growth chart in the README and history.
            
            - Updated `README.md`
            - Updated `stars_history.json`
          base: master
      
      - name: âœ… Workflow completed
        run: |
          echo "ğŸ‰ Star update workflow completed successfully!"
          echo "ğŸ“Š Chart updates every 10 minutes"
          echo "ğŸ“ˆ Growth history saved to stars_history.json"
